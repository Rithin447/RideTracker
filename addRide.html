<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Ride</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <<div class="navbar">
    <div class="nav-left">
      <a href="index.html">Home</a>
      <a href="addRide.html">Add Ride</a>
      <a href="summary.html">Weekly Summary</a>
      <a href="profileSummary.html">Profile Summary</a>
    </div>
    <div class="nav-right">
      <span id="welcomeMsg" style="color: white; margin-right: 20px;"></span>
      <div class="profile-icon" onclick="toggleProfileMenu()">
        <span id="profileInitials"></span>
        <div id="profileMenu" class="dropdown-content">
          <a href="#" onclick="logout()">Logout</a>
        </div>
      </div>
    </div>
  </div>
  

  <div class="container">
    <h1>Add a Ride</h1>

    <div class="form-group">
      <label for="newPerson">Add New Person:</label>
      <input type="text" id="newPerson" placeholder="Enter name">
      <button type="button" class="btn" onclick="addPerson()">Add</button>
    </div>

    <form id="rideForm">
      <div class="form-group">
        <label for="name">Name:</label>
        <select id="name" required>
          <option value="">--Select Person--</option>
          <option value="Suma">Suma</option>
          <option value="Jakki">Jakki</option>
          <option value="Rithin">Rithin</option>
        </select>
      </div>

      <div class="form-group">
        <label for="date">Date:</label>
        <input type="date" id="date" required>
      </div>

      <div class="form-group">
        <label for="location">Location:</label>
        <select id="location" required>
          <option value="">--Select Location--</option>
          <option value="Mills">Mills</option>
          <option value="Motel">Motel</option>
        </select>
      </div>

      <div class="form-group">
        <label for="tripType">Trip Type:</label>
        <select id="tripType" required>
          <option value="">--Select Trip Type--</option>
          <option value="One-way">One-way</option>
          <option value="Round-trip">Round-trip</option>
        </select>
      </div>

      <div class="form-group">
        <label for="carTo">Car (To):</label>
        <select id="carTo" required>
          <option value="">--Select Car--</option>
          <option value="Nissan">Nissan</option>
          <option value="Hybrid">Hybrid</option>
          <option value="Honda">Honda</option>
          <option value="Ford">Ford</option>
        </select>
      </div>

      <div class="form-group">
        <label for="carReturn">Car (Return):</label>
        <select id="carReturn">
          <option value="">--Select Car--</option>
          <option value="Nissan">Nissan</option>
          <option value="Hybrid">Hybrid</option>
          <option value="Honda">Honda</option>
          <option value="Ford">Ford</option>
        </select>
      </div>

      <button type="submit" class="btn">Submit Ride</button>
    </form>

    <div id="result"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="app.js"></script>
  <script>
    window.onload = function () {
      const initials = localStorage.getItem('userInitials');
      if (initials) {
        document.getElementById('profileInitials').innerText = initials;
      }
    };

    function toggleProfileMenu() {
      const menu = document.getElementById("profileMenu");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    function addPerson() {
      const newPersonInput = document.getElementById("newPerson");
      const newName = newPersonInput.value.trim();
      const nameSelect = document.getElementById("name");

      if (newName) {
        const optionExists = Array.from(nameSelect.options).some(opt => opt.value === newName);
        if (!optionExists) {
          const newOption = document.createElement("option");
          newOption.value = newName;
          newOption.textContent = newName;
          nameSelect.appendChild(newOption);
          nameSelect.value = newName;
          newPersonInput.value = "";
        } else {
          alert("Name already exists in the list.");
        }
      } else {
        alert("Please enter a name.");
      }
    }

    document.getElementById("rideForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const date = document.getElementById("date").value;
      const location = document.getElementById("location").value;
      const tripType = document.getElementById("tripType").value;
      const carTo = document.getElementById("carTo").value;
      const carReturn = document.getElementById("carReturn").value;

      let fare = 0;
      if (location === "Mills") {
        fare = tripType === "Round-trip" ? 8 : 4;
      } else if (location === "Motel") {
        fare = tripType === "Round-trip" ? 10 : 5;
      }

      const rideData = { name, date, location, tripType, fare, carTo, carReturn };
      firebase.database().ref("rides").push(rideData)
        .then(() => {
          document.getElementById("result").innerText = "‚úÖ Ride added successfully!";
          document.getElementById("rideForm").reset();
        })
        .catch(err => {
          document.getElementById("result").innerText = "‚ùå Error: " + err.message;
        });
    });

    window.onload = function () {
    const initials = localStorage.getItem("userInitials");
    const firstName = localStorage.getItem("firstName");
    
    if (initials) {
      document.getElementById("profileInitials").innerText = initials;
    }
    if (firstName) {
      document.getElementById("welcomeMsg").innerText = "Welcome, " + firstName;
    }
  };
  function loadMembers() {
  const nameSelect = document.getElementById("name");
  nameSelect.innerHTML = '<option value="">--Select Person--</option>';

  firebase.database().ref("members").once("value").then(snapshot => {
    snapshot.forEach(child => {
      const option = document.createElement("option");
      option.value = child.val();
      option.textContent = child.val();
      nameSelect.appendChild(option);
    });
  });
}
function addPerson() {
  const newPersonInput = document.getElementById("newPerson");
  const newName = newPersonInput.value.trim();

  if (!newName) {
    alert("Please enter a name.");
    return;
  }

  firebase.database().ref("members").once("value").then(snapshot => {
    let exists = false;
    snapshot.forEach(child => {
      if (child.val().toLowerCase() === newName.toLowerCase()) {
        exists = true;
      }
    });

    if (exists) {
      alert("This name already exists.");
    } else {
      firebase.database().ref("members").push(newName).then(() => {
        newPersonInput.value = "";
        loadMembers(); // refresh the dropdown
      });
    }
  });
}
window.onload = function () {
  const initials = localStorage.getItem("userInitials");
  const firstName = localStorage.getItem("firstName");
  if (initials) {
    document.getElementById("profileInitials").innerText = initials;
  }
  if (firstName) {
    document.getElementById("welcomeMsg").innerText = "Welcome, " + firstName;
  }

  loadMembers(); // üëà this is the key!
};

  </script>
</body>
</html>
